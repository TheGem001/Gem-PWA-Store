<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Gem Store | Gem Labs</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#FFFFFF">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap');
        
        :root { --gem-black: #111111; --gem-ghost: #F9FAFB; }

        * {
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            -webkit-user-select: none;
            outline: none;
        }

        input { user-select: text; -webkit-user-select: text; }

        body { 
            background: #FFFFFF; 
            color: var(--gem-black); 
            -webkit-font-smoothing: antialiased; 
            font-family: 'Inter', -apple-system, sans-serif;
            letter-spacing: -0.01em;
            overflow-x: hidden;
        }
        
        .shimmer { 
            background: linear-gradient(90deg, #f0f0f0 25%, #f8f8f8 50%, #f0f0f0 75%); 
            background-size: 200% 100%; 
            animation: shim 1.5s infinite; 
        }
        @keyframes shim { 0% { background-position: -200% 0; } 100% { background-position: 200% 0; } }
        
        .app-card { transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1); }
        .app-card:active { transform: scale(0.96); background-color: var(--gem-ghost); }

        .safe-bottom { padding-bottom: calc(1.5rem + env(safe-area-inset-bottom)); }
        
        .modal-sheet { transition: transform 0.5s cubic-bezier(0.32, 0.72, 0, 1); }

        .glass {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
        }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        #carousel-container { display: flex; transition: transform 0.6s cubic-bezier(0.23, 1, 0.32, 1); }
        .slide { min-width: 100%; }
        .dot { transition: width 0.3s, background-color 0.3s; }
        .dot.active { width: 1.5rem; background-color: black; }

        /* Ensure images in slides cover properly */
        .slide-img { width: 100%; height: 100%; object-fit: cover; }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <header class="sticky top-0 z-50 glass border-b border-gray-100 px-6 py-5 flex justify-between items-center">
        <div class="flex items-center gap-3">
            <div class="w-9 h-9 bg-black rounded-xl flex items-center justify-center shadow-sm active:scale-90 transition-transform cursor-pointer" onclick="window.location.reload()">
                <img src="assets/gem-logo.svg" class="w-5 h-5" alt="Logo">
            </div>
            <div>
                <h1 class="text-lg font-extrabold tracking-tighter leading-none">Gem Store</h1>
                <p class="text-[10px] text-gray-400 font-bold uppercase tracking-wider">Labs Edition</p>
            </div>
        </div>
        <div class="flex items-center gap-3">
            <button id="install-btn" class="hidden text-[11px] font-black bg-black text-white px-4 py-2 rounded-full active:scale-90 transition-transform uppercase tracking-wider">
                Install
            </button>
            <button onclick="toggleAbout(true)" class="w-9 h-9 rounded-full bg-gray-50 border border-gray-100 flex items-center justify-center active:scale-90 transition-transform">
                <i data-lucide="info" class="w-4 h-4 text-black"></i>
            </button>
        </div>
    </header>

    <main class="flex-1 max-w-2xl mx-auto w-full py-8">
        
        <div class="px-6 relative mb-10 group">
            <i data-lucide="search" class="absolute left-10 top-1/2 -translate-y-1/2 text-gray-400 w-4 h-4 group-focus-within:text-black transition-colors"></i>
            <input type="text" id="search" placeholder="Search applications..." class="w-full bg-gray-50 border border-transparent rounded-[1.5rem] py-5 pl-14 pr-6 outline-none focus:bg-white focus:border-black/5 focus:ring-4 focus:ring-black/5 transition-all text-sm font-medium">
        </div>

        <div class="mb-10 overflow-hidden relative" id="carousel-wrapper">
            <div class="flex justify-between items-center px-6 mb-6">
                <h3 class="text-xs font-black uppercase tracking-[0.2em] text-gray-400">Featured Highlights</h3>
                <div id="carousel-dots" class="flex gap-1.5"></div>
            </div>
            <div id="carousel-container">
                <div class="slide px-6"><div class="w-full h-52 rounded-[2.5rem] shimmer"></div></div>
            </div>
        </div>

        <div class="px-6 mb-4 flex items-baseline justify-between">
            <h3 class="text-xs font-black uppercase tracking-[0.2em] text-gray-400">App Directory</h3>
            <span id="app-count" class="text-[10px] font-bold text-gray-300 italic"></span>
        </div>
        
        <div id="apps" class="px-6 space-y-3">
            <div class="h-24 shimmer rounded-[2rem]"></div>
            <div class="h-24 shimmer rounded-[2rem]"></div>
        </div>
    </main>

    <!-- Modal -->
    <div id="modal-container" class="fixed inset-0 z-[60] bg-black/40 backdrop-blur-sm hidden flex items-end justify-center p-0 opacity-0 transition-opacity duration-300">
        <div id="modal-content" class="modal-sheet bg-white w-full max-w-xl rounded-t-[3rem] p-10 transform translate-y-full shadow-2xl relative">
            <div class="absolute top-4 left-1/2 -translate-x-1/2 w-10 h-1 bg-gray-100 rounded-full"></div>
            <div class="flex justify-between items-start mb-10">
                <div id="m-icon" class="w-24 h-24 bg-black rounded-[2.5rem] shadow-xl overflow-hidden flex items-center justify-center p-0"></div>
                <div class="flex gap-2">
                    <button id="m-share" class="p-3.5 bg-gray-50 rounded-full active:scale-90 transition-transform"><i data-lucide="share" class="w-5 h-5 text-black"></i></button>
                    <button onclick="closeModal()" class="p-3.5 bg-gray-50 rounded-full active:scale-90 transition-transform"><i data-lucide="x" class="w-5 h-5 text-gray-400"></i></button>
                </div>
            </div>
            <div class="mb-8">
                <h3 id="m-title" class="text-4xl font-black mb-1 tracking-tighter leading-tight"></h3>
                <p id="m-cat" class="text-gray-400 text-xs font-black uppercase tracking-[0.25em]"></p>
            </div>
            <p id="m-desc" class="text-gray-600 leading-relaxed text-sm mb-10 font-medium"></p>
            <div class="grid grid-cols-2 gap-4 mb-10">
                <div class="bg-gray-50 p-5 rounded-3xl border border-gray-100">
                    <p class="text-[10px] text-gray-400 uppercase font-black mb-1 tracking-widest">Version</p>
                    <p id="m-ver" class="font-bold text-black text-sm"></p>
                </div>
                <button id="feedback-btn" class="bg-gray-50 p-5 rounded-3xl border border-gray-100 text-left active:scale-95 transition-transform">
                    <p class="text-[10px] text-gray-400 uppercase font-black mb-1 tracking-widest">Support</p>
                    <p class="font-bold text-black text-sm flex items-center justify-between">Email <i data-lucide="mail" class="w-3 h-3 text-gray-300"></i></p>
                </button>
            </div>
            <!-- Standard button with JS handler for link breakout -->
            <button id="m-link-btn" class="block w-full bg-black text-white text-center py-5 rounded-[2rem] font-black text-sm uppercase tracking-widest shadow-black/20 active:scale-[0.98] transition-all">Get Application</button>
            <div class="h-8 safe-bottom"></div>
        </div>
    </div>

    <!-- About Modal -->
    <div id="about-modal" class="fixed inset-0 z-[70] bg-white hidden overflow-y-auto">
        <div class="max-w-xl mx-auto px-8 py-20">
            <button onclick="toggleAbout(false)" class="mb-10 p-3 bg-gray-50 rounded-full active:scale-90 transition-transform"><i data-lucide="arrow-left" class="w-6 h-6"></i></button>
            <h2 class="text-5xl font-black tracking-tighter mb-6">About Gem Labs.</h2>
            <p class="text-lg text-gray-500 leading-relaxed mb-10">We build high-performance software for the next generation of the web. Focused on privacy, minimalism, and the "Gem Mono" design philosophy.</p>
            <div class="space-y-12">
                <div><h4 class="text-xs font-black uppercase tracking-widest text-gray-400 mb-2">Founder</h4><p class="font-bold text-xl text-black">Saqib Zahid</p></div>
                <div><h4 class="text-xs font-black uppercase tracking-widest text-gray-400 mb-2">Contact</h4><p class="font-bold text-xl text-black">saqibzahidofficial@gmail.com</p></div>
                <!-- V1.6: App Version Info -->
                <div class="pt-8 border-t">
                    <h4 class="text-xs font-black uppercase tracking-widest text-gray-400 mb-2">Store Version</h4>
                    <p class="font-mono text-xs text-gray-400">Build 1.6.0-stable</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let data = [];
        let slides = [];
        let currentSlide = 0;
        const FEEDBACK_EMAIL = "saqibzahidofficial@gmail.com";

        const renderIcon = (icon) => (icon.includes('.') || icon.includes('/')) ? `<img src="${icon}" class="w-full h-full object-cover">` : `<div class="w-full h-full flex items-center justify-center bg-black text-white"><i data-lucide="${icon}" class="w-1/2 h-1/2"></i></div>`;

        async function init() {
            try {
                const t = Date.now();
                const [appsRes, slidesRes] = await Promise.all([
                    fetch(`./apps.json?t=${t}`),
                    fetch(`./slides.json?t=${t}`)
                ]);
                data = await appsRes.json();
                slides = await slidesRes.json();
                render(data);
                renderSlides(slides);
                document.getElementById('app-count').innerText = `${data.length} apps available`;
            } catch (e) { console.error("Data Load Error"); }
            
            lucide.createIcons();
            
            document.getElementById('search').oninput = (e) => {
                const q = e.target.value.toLowerCase();
                render(data.filter(a => a.name.toLowerCase().includes(q) || a.category.toLowerCase().includes(q)));
            };

            window.addEventListener('popstate', () => {
                if (!document.getElementById('modal-container').classList.contains('hidden')) closeModal(false);
                else if (!document.getElementById('about-modal').classList.contains('hidden')) toggleAbout(false, false);
            });

            if ('serviceWorker' in navigator) navigator.serviceWorker.register('./sw.js');
            
            setInterval(() => {
                if(slides.length > 0) moveSlide((currentSlide + 1) % slides.length);
            }, 6000);
        }

        function renderSlides(items) {
            const container = document.getElementById('carousel-container');
            const dots = document.getElementById('carousel-dots');
            
            container.innerHTML = items.map(item => `
                <div class="slide px-6">
                    <div onclick="handleSlideAction('${item.action}')" class="w-full h-52 rounded-[2.5rem] relative overflow-hidden shadow-2xl shadow-black/10 active:scale-95 transition-transform cursor-pointer">
                        <img src="${item.image}" class="slide-img absolute inset-0" alt="Featured">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/90 via-black/10 to-transparent"></div>
                        <div class="absolute bottom-8 left-8">
                            <span class="bg-white/20 backdrop-blur-md text-white text-[9px] font-black uppercase px-2.5 py-1 rounded-md mb-2 inline-block tracking-widest">${item.label}</span>
                            <h4 class="text-2xl font-bold text-white tracking-tight">${item.title}</h4>
                            <p class="text-white/60 text-xs">${item.subtitle}</p>
                        </div>
                    </div>
                </div>
            `).join('');
            
            dots.innerHTML = items.map((_, i) => `<div class="dot h-1.5 rounded-full bg-gray-200 ${i === 0 ? 'active' : 'w-1.5'}"></div>`).join('');
            lucide.createIcons();
        }

        function moveSlide(index) {
            currentSlide = index;
            const container = document.getElementById('carousel-container');
            const dots = document.querySelectorAll('.dot');
            container.style.transform = `translateX(-${index * 100}%)`;
            dots.forEach((dot, i) => {
                dot.className = `dot h-1.5 rounded-full ${i === index ? 'active' : 'w-1.5 bg-gray-200'}`;
            });
        }

        function handleSlideAction(action) {
            if (action === 'about') toggleAbout(true);
            else {
                const app = data.find(a => a.id === action);
                if (app) openModal(app);
            }
        }

        function render(apps) {
            const container = document.getElementById('apps');
            container.innerHTML = apps.map(app => `
                <div onclick='openModal(${JSON.stringify(app)})' class="app-card flex items-center justify-between p-5 bg-white border border-gray-100 rounded-[2.2rem] cursor-pointer shadow-sm">
                    <div class="flex items-center gap-5">
                        <div class="w-16 h-16 rounded-[1.3rem] overflow-hidden shadow-sm bg-gray-50 border border-gray-50">${renderIcon(app.icon)}</div>
                        <div>
                            <div class="flex items-center gap-2 mb-0.5">
                                <h4 class="font-bold text-base tracking-tight">${app.name}</h4>
                                ${app.status ? `<span class="text-[8px] font-black uppercase bg-gray-100 text-gray-500 px-1.5 py-0.5 rounded-sm tracking-widest">${app.status}</span>` : ''}
                            </div>
                            <p class="text-[11px] text-gray-400 font-bold uppercase tracking-widest">${app.category}</p>
                        </div>
                    </div>
                    <div class="bg-gray-50 text-black h-10 w-16 flex items-center justify-center rounded-full text-[10px] font-black tracking-tighter">GET</div>
                </div>
            `).join('');
            lucide.createIcons();
        }

        function openModal(app) {
            document.getElementById('m-title').innerText = app.name;
            document.getElementById('m-cat').innerText = app.category;
            document.getElementById('m-desc').innerText = app.description;
            document.getElementById('m-ver').innerText = app.version;
            document.getElementById('m-icon').innerHTML = renderIcon(app.icon);
            document.getElementById('feedback-btn').onclick = () => window.location.href = `mailto:${FEEDBACK_EMAIL}?subject=Feedback: ${app.name}`;
            
            // v1.6: Fixed Link logic - using window.open for reliable breakout
            document.getElementById('m-link-btn').onclick = () => {
                if (app.url === "#") return;
                const newWindow = window.open(app.url, '_blank');
                if (newWindow) newWindow.focus();
                else window.location.href = app.url;
            };

            document.getElementById('m-share').onclick = async () => {
                if (navigator.share) await navigator.share({ title: app.name, url: app.url });
                else { navigator.clipboard.writeText(app.url); alert("Link Copied"); }
            };

            const container = document.getElementById('modal-container');
            const content = document.getElementById('modal-content');
            window.history.pushState({modal: true}, "");
            container.classList.remove('hidden');
            setTimeout(() => { container.style.opacity = '1'; content.classList.remove('translate-y-full'); }, 10);
            lucide.createIcons();
        }

        function closeModal(doPop = true) {
            if (doPop) window.history.back();
            const container = document.getElementById('modal-container');
            const content = document.getElementById('modal-content');
            container.style.opacity = '0';
            content.classList.add('translate-y-full');
            setTimeout(() => container.classList.add('hidden'), 500);
        }

        function toggleAbout(show, doPop = true) {
            const about = document.getElementById('about-modal');
            if (show) { window.history.pushState({about: true}, ""); about.classList.remove('hidden'); } 
            else { if (doPop) window.history.back(); about.classList.add('hidden'); }
            lucide.createIcons();
        }

        window.onload = init;
    </script>
</body>
</html>

